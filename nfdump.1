.TH nfdump 1 2004-06-30 "" ""
.SH NAME
nfdump \- netflow display and analyze program
.SH SYNOPSIS
.HP 5
.B nfdump [options] [filter]
.SH DESCRIPTION
.B nfdump
is the netflow display and analyzing program of the nfdump tool set. 
It reads the netflow data from the files stored by nfcapd. The options
and filter syntax are similar to tcpdump and extended for netflow data. 
Nfdump can also display top N statistics for packets and bytes, as well
as for other fields such as IP addresses ports and AS numbers.

.SH OPTIONS
.TP 3
.B -r \fIinputfile
Read input data from \fIinputfile\fR. Default is read from stdin.
.TP 3
.B -R \fIexpr
Read input from a sequence of concatenated files. The \fIexpr\fR
may be one of:
.PD 0
.RS 4
/any/\fIdir\fR          Read all files in directory \fIdir\fR.
.P
/dir/\fIfile\fR         Read all files beginning with \fIfile\fR.
.P
/dir/\fIfile1:file2\fR  Read all files from \fIfile1\fR to \fIfile2\fR.
.RE
.PD
.TP 3
.B -M \fIexpr
Read input from multiple directories. The \fIexpr\fR looks like:
\fI/any/path/to/dir1:dir2:dir3\fR etc. and will be expanded to the
directories: \fI/any/path/to/dir1\fR, \fI/any/path/to/dir2\fR and 
\fI/any/path/to/dir3\fR Any number of colon separated directories may 
be given. The files to read are specified by -r or -R and are expected 
to exist in all the given directories.  The options -r and -R must 
not contain any directory part when used in conjunction with -M.
.TP 3
.B -m
Sort the netflow records according the date first seen. This option is
usually only useful in conjunction with -M, when netflow records are 
read from different sources, which are not necessarily sorted.
.TP 3
.B -w \fIoutputfile
If specified writes binary netflow records to \fIoutputfile\fR ready
to be processed again with nfdump. The default output is ASCII on
stdout.
.TP 3
.B -f \fIfilterfile
Reads the filter syntax from \fIfilterfile\fR. Note: Any filter specified
directly on the command line takes precedence over -f.
.TP 3
.B -t \fItimewin
Process only flows, which fall in the time window \fItimewin\fR, where
\fItimewin\fR is YYYY/MM/dd.hh:mm:ss[-YYYY/MM/dd.hh:mm:ss]. Any parts of
the time spec may be omitted e.g YYYY/MM/dd expands to 
YYYY/MM/dd.00:00:00-YYYY/MM/dd.23:59:59 and processes all flow from a 
given day. The time window may also be specified as +/- n. In this case
it is relativ to the beginning or end of all flows. +10 means the first
10 seconds of all flows, -10 means the last 10 seconds of all flows.
.TP 3
.B -c \fInum
Limit number of records to process to the first \fInum\fR flows.
.TP 3
.B -a
Aggregate netflow data. Aggregation is done at connection level.
.TP 3
.B -A \fIfields
Aggregate netflow data using the specified fields, where fields is a ',' 
separated list out of \fIsrcip dstip srcport dstport\fR. The default is using
all fields: \fIsrcip,dstip,srcport,dstport\fR
.TP 3
.B -S
Generate Top N statistics. The aggregated flows with Top N packets and 
Top N bytes are reported. Implies -a.
.TP 3
.B -s \fIstatistics
Generate the Top N statistic. \fIstatistics\fR can be:
.PD 0
.RS 4
srcip	Statistics about the source IP address
.P
dstip	Statistics about the destination IP address
.P
srcport	Statistics about the source port
.P
dstport	Statistics about the destination port
.P
srcas	Statistics about the source AS number
.P
dstas	Statistics about the destination AS number
.RE
.PD
.TP 3
.B -l \fI[+/-]packet_num
Limit statistics output to those records above or below the \fIpacket_num\fR 
limit. \fIpacket_num\fR accepts positive or negative numbers followed by 'K'
, 'M' or 'G' 10E3, 10E6 or 10E9 flows respectively. See also note at -L
.TP 3
.B -L \fI[+/-]byte_num
Limit statistics output to those records above or below the \fIbyte_num\fR 
limit. \fIbyte_num\fR accepts positive or negative numbers followed by 'K'
, 'M' or 'G' 10E3, 10E6 or 10E9 bytes respectively. \fINote:\fR These limits only
apply to the statistics and aggregated outputs generated with -a -s or -S.
To filter netflow records by packets and bytes, use the filter syntax 'packets'
and 'bytes' described below.
.TP 3
.B -n \fInum
Define the number for the Top N statistics. Defaults to 10. If 0 is specified
the number is unlimited.
.TP 3
.B -o \fIformat
Print netflow using format \fIformat\fR. The following formats are available:
.PD 0
.RS 4
line		Print each record on one line.Default format.
.P
long		Print more details of record on one line.
.P
extended	Print each netflow record in extended multi line format.
.P
pipe		Machine readable format: Print all fields '|' separated.
.RE
.PD
.TP 3
.B -Z
Check filter syntax and exit. Sets the return value accordingly.
.TP 3
.B -X
Compiles the filer syntax and dumps the filter engine table to stdout.
This is for debugging purpose only.
.TP 3
.B -V
Print nfdump version and exit.
.TP 3
.B -h
Print help text on stdout with all options and exit.
.SH "RETURN VALUE"
Returns 
.PD 0
.RS 4 
0   No error. \fn
.P
255 Initialization failed.
.P
254 Error in filter syntax.
.P
250 Internal error.
.RE
.PD
.SH "OUTPUT FORMATS"
The output formats \fBline\fR and \fBlong\fR have header lines to describe the
individual columns of the output. The \fBpipe\fR output format consists of UNIX
time flow start, UNIX time flow end, Protocol number, source IP address, source port,
destination IP address, destination port, TCP flags, tos, packets, bytes. IP 
addresses are printed as 32bit integer.
.SH "FILTER"
The filter syntax is similar to the well known pcap library used by tcpdump.
The filter can be either specified on the command line after all options or 
in a separate file. It can span several lines. Anything after a '#' is treated as a 
comment and ignored to the end of the line. There is virtually no limit in 
the length of the filter expression. All keywords are case independent.
.P Syntax
Any filter consists of one or more expressions \fIexpr\fR. Any number of \fIexpr\fR
can be linked together:
.P
expr \fBand\fR expr, expr \fBor\fR expr, \fBnot\fR expr and \fB(\fR expr \fB)\fR.
.P
\fIExpr\fR can be one of the following filter primitives:
.TP 4
.I protocol
\fBTCP, UDP, ICMP\fR or \fBPROTO\fR \fInum\fR where \fInum\fR is the protocol 
number.
.TP 4
.I IP address
.PD 0
.RS 4
\fB[SourceDestination]\fR \fBIP\fR \fIa.b.c.d\fR or
.P
\fB[SourceDestination]\fR \fBHOST\fR \fIa.b.c.d\fR with \fIa.b.c.d\fR as any valid IP address.
\fISourceDestination\fR may be omitted.
.RE
.PD
.TP 4
.I SourceDestination
defines the IP address to be selected and can be \fBSRC\fR 
\fBDST\fR or any combination of \fBSRC and|or DST\fR. Ommiting \fISourceDestination\fR is 
equivalent to \fBSRC or DST\fR.
.TP 4
.I network
\fI[SourceDestination]\fR \fBNET\fR \fIa.b.c.d\fR \fIm.n.r.s\fR
.PD 0
.RS 4
\fI[SourceDestination]\fR \fBNET\fR \fIa.b.c.d\fR / \fInum\fR with \fIa.b.c.d\fR 
as network number, \fIm.n.r.s\fR as netmask or \fInum\fR as maskbits respectively. 
The network may be given as \fIa.b\fR, \fIa.b.c\fR, where a B or C-class equivalent netmask 
is assumed.
.RE
.PD
.TP 4 
.I Port
\fI[SourceDestination]\fR  \fBPORT\fR \fI[comp]\fR \fInum\fR with \fInum\fR as a valid port number.
If \fIcomp\fR is omitted, '=' is assumed.
.TP 4
.I Flags
\fBflags\fR \fItcpflags\fR with \fItcpflags\fR as a combination of:
.PD 0
.RS 4
A	ACK.
.P
S	SYN.
.P
F	FIN.
.P
R	Reset.
.P
P	Push.
.P
U	Urgent.
.P
X	All flags on.
.RE
.PD
The ordering of the flags is not relevant. Flags not mentioned are treated as don't care.
In order to get those flows with only the SYN flag set, use the syntax '\fBflags S and not
flags AFRPU\R'.
.TP 4 
.I TOS
Type of service: \fBtos\fR \fIvalue\fR with \fIvalue\fR 0..255.
.TP 4 
.I Packets
\fBpackets\fR \fI[comp]\fR \fInum\fR to limit the packet count in the netflow record.
.TP 4 
.I Bytes
\fBbytes\fR \fI[comp]\fR \fInum\fR to limit the byte count in the netflow record.
.TP 4
\fIcomp\fR The following comparators are supported:
.B =, ==, >, <,  EQ, LT, GT .
If \fIcomp\fR is omitted, '=' is assumed.
.TP 4
.I AS
\fI[SourceDestination]\fR  \fBAS\fR \fInum\fR with \fInum\fR as a valid AS number.
.SH "EXAMPLES"
.B nfdump -r /and/dir/nfcapd.200407110845 -c 100 'tcp and ( src ip 172.16.17.18 or dst ip 172.16.17.19 )'
Dumps the first 100 netflow records which match the given filter:
.P
.B nfdump -R /and/dir/nfcapd.200407110845:nfcapd.200407110945 'host 192.168.1.2'
Dumps all netflow records of host 192.168.1.2 from July 11 08:45 - 09:45
.P
.B nfdump -M /to/and/dir1:dir2 -R nfcapd.200407110845:nfcapd.200407110945  -S -n 20
Generates the Top 20 statistics from 08:45 to 09:45 from 3 sources
.P
.B nfdump -r /and/dir/nfcapd.200407110845 -S -n 20
Generates the Top 20 statistics 
.P
.B cat file1 file2 file3 | nfdump 'tcp and ( src port > 1024 and dst port 80 )
nfdump reads from stdin and dumps all port 80 connections to any web server.
.SH NOTES
Generating the statistics for data files of a few hundred MB should be no problem. However
be careful if you want to create statistics of several GB of data. This may consume a lot
of memory and can take a while. 
.SH "SEE ALSO"
nfcapd(1), nfprofile(1), nfreplay(1)
.SH BUGS
There is still the famous last bug. Please report them - all the last bugs - back to me.

