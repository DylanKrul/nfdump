#  Building Open Source Network Security Tools
#
#  This file is part of the nfdump project.
#
#  Copyright (c) 2004, SWITCH - Teleinformatikdienste fuer Lehre und Forschung
#  All rights reserved.
#   
#  Redistribution and use in source and binary forms, with or without 
#  modification, are permitted provided that the following conditions are met:
#  
#   * Redistributions of source code must retain the above copyright notice, 
#     this list of conditions and the following disclaimer.
#   * Redistributions in binary form must reproduce the above copyright notice, 
#     this list of conditions and the following disclaimer in the documentation 
#     and/or other materials provided with the distribution.
#   * Neither the name of SWITCH nor the names of its contributors may be 
#     used to endorse or promote products derived from this software without 
#     specific prior written permission.
#  
#  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" 
#  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE 
#  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE 
#  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE 
#  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR 
#  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF 
#  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS 
#  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN 
#  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) 
#  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE 
#  POSSIBILITY OF SUCH DAMAGE.
#   
#
#  $Author: peter $
#
#  $Id: Makefile.in 92 2007-08-24 12:10:24Z peter $
#

srcdir	 = .
DESTDIR	 =
CC		 = @CC@ 
YACC	 = @YACC@
LEX		 = @LEX@
INSTALL	 = @INSTALL@
CFLAGS	 = @CFLAGS@ 
CPPFLAGS = @CPPFLAGS@
YFLAGS	 = -d -v
LFLAGS	 = @LFLAGS@
LDFLAGS	 = @LDFLAGS@
prefix   = @prefix@
PREFIX	 = $(DESTDIR)/$(prefix)
MANDIR 	 = $(DESTDIR)/@mandir@
COMMON_OBJ	= nffile.o nf_common.o util.o flist.o panonymizer.o rijndael.o @FTS_OBJ@
FILTER_OBJ	= grammar.o scanner.o nftree.o ipconv.o
NFDUMP_OBJ	= nfdump.o $(COMMON_OBJ) $(FILTER_OBJ) nfstat.o nfprof.o
NFRPLY_OBJ	= nfreplay.o $(COMMON_OBJ) $(FILTER_OBJ) nfprof.o nfnet.o netflow_v9.o netflow_v5_v7.o
NFPROF_OBJ	= nfprofile.o profile.o nfstatfile.o $(COMMON_OBJ) $(FILTER_OBJ)
NFEXPR_OBJ	= nfexpire.o expire.o bookkeeper.o nfstatfile.o util.o @FTS_OBJ@
NFCAPD_OBJ	= nfcapd.o $(COMMON_OBJ) nfnet.o netflow_v9.o netflow_v5_v7.o launch.o bookkeeper.o expire.o nfstatfile.o
SFCAPD_OBJ	= sfcapd.o $(COMMON_OBJ) nfnet.o sflow.o launch.o bookkeeper.o expire.o nfstatfile.o
FT2NF_OBJ	= ft2nfdump.o $(COMMON_OBJ) 
NFRDR_OBJ	= nfreader.o nffile.o flist.o util.o
OBJECTS  =	 nfcapd nfdump nfreplay nfexpire nftest nfgen @opt_objects@
INCS	 	= @FT_INCLUDES@
LIBS	 	= @LIBS@
FT_LIBS	 	= -lft -lz
FT_LDFLAGS  = @FT_LDFLAGS@
WARNINGS = -Wall -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -Wmissing-noreturn

.c.o:
	$(CC) -c $(CPPFLAGS) $(CFLAGS) $(INCS) $<

all: $(OBJECTS)

nfcapd:	$(NFCAPD_OBJ)
	$(CC) $(CFLAGS) -o $@ $(NFCAPD_OBJ) $(LDFLAGS) $(LIBS)

sfcapd: $(SFCAPD_OBJ)
	$(CC) $(CFLAGS) -o $@ $(SFCAPD_OBJ) $(LDFLAGS) $(LIBS)

nftest: nftest.o $(COMMON_OBJ) $(FILTER_OBJ)
	$(CC) $(CFLAGS) $(INCS) -o $@ nftest.o $(COMMON_OBJ) $(FILTER_OBJ) $(LDFLAGS) $(LIBS)

nfgen: nfgen.o
	$(CC) $(CFLAGS) $(INCS) -o $@ $? $(LDFLAGS) $(LIBS)

nfdump: $(NFDUMP_OBJ)
	$(CC) $(CFLAGS) $(INCS) -o $@ $(NFDUMP_OBJ) $(LDFLAGS) $(LIBS)

nfprofile: $(NFPROF_OBJ)
	$(CC) $(CFLAGS) $(INCS) -o $@ $(NFPROF_OBJ) $(LDFLAGS) $(LIBS)

nfreplay: $(NFRPLY_OBJ)
	$(CC) $(CFLAGS) $(INCS) -o $@ $(NFRPLY_OBJ) $(LDFLAGS) $(LIBS)

nfexpire: $(NFEXPR_OBJ)
	$(CC) $(CFLAGS) $(INCS) -o $@ $(NFEXPR_OBJ) $(LDFLAGS)

ft2nfdump: $(FT2NF_OBJ)
	$(CC) $(CFLAGS) -o $@ $(FT2NF_OBJ) $(LDFLAGS) $(FT_LDFLAGS) $(FT_LIBS)

nfreader: $(NFRDR_OBJ)
	$(CC) $(CFLAGS) -o $@ $(NFRDR_OBJ) $(LDFLAGS)

install: $(OBJECTS)
	test -d $(PREFIX) || install -d -o root -g bin -m 755 $(PREFIX)
	test -d $(PREFIX)/bin || install -d -o root -g bin -m 755 $(PREFIX)/bin
	test -d $(MANDIR) || install -d -o root -g bin -m 755 $(MANDIR)
	test -d $(MANDIR)/man1 || install -d -o root -g bin -m 755 $(MANDIR)/man1
	for file in $(OBJECTS); do \
		if [ -f $$file.1 ]; then \
			$(INSTALL) -o root -g bin -m 755 $$file $(PREFIX)/bin ; \
			$(INSTALL) -o root -g bin -m 644 $$file.1 $(MANDIR)/man1 ; \
		fi \
	done;

uninstall:
	for file in $(OBJECTS); do \
		if [ -f $$file.1 ]; then \
			/bin/rm -f  $(PREFIX)/bin/$$file ; \
			/bin/rm -f  $(MANDIR)/man1/$$file.1 ; \
		fi \
	done;

test: nftest
	./test.sh

clean:
	rm -f *.o *~ y.* *.tab.* *core* $(OBJECTS) grammar.h grammar.c scanner.c

distclean:
	rm -f *.o *~ y.* *.tab.* *core* $(OBJECTS) grammar.h grammar.c scanner.c
	rm -f config.log config.h config.status Makefile

lint:
	splint -warnposix *.c

grammar.h: grammar.c
grammar.c: grammar.y
	@rm -f grammar.c grammar.h
	$(YACC) $(YFLAGS) $<
	mv y.tab.c grammar.c
	mv y.tab.h grammar.h

scanner.c: scanner.l
	@rm -f $@
	$(LEX) $(LFLAGS) $< 
	mv lex.yy.c $@

depend: grammar.c scanner.c
	makedepend $(CPPFLAGS) -- *.c *.h

# EOF
# DO NOT DELETE
